{
  "hash": "ad0d0a9c304a2d4c762428da8e9167b7",
  "result": {
    "markdown": "---\ntitle: \"Challenge 4\"\nauthor: \"Tim Shores\"\ndescription: \"More data wrangling: pivoting\"\ndate: \"03/18/2023\"\nformat:\n  html:\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\n    link-external-icon: true\n    link-external-newwindow: true\n    link-external-filter: '^(?:http:|https:)\\/\\/www\\.quarto\\.org\\/custom'\ncategories:\n  - challenge_4\n  - eggs\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n#| label: setup\n#| warning: false\n#| message: false\n\nmy_packages <- c(\"tidyverse\", \"readxl\", \"knitr\", \"zoo\") # create vector of packages\ninvisible(lapply(my_packages, require, character.only = TRUE)) # load multiple packages\n\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n## Challenge Overview\n\nChallenge 4 includes four tasks:\n\n1)  read in a data set, and describe the data set using both words and any supporting information (e.g., tables, etc)\n2)  tidy data (as needed, including sanity checks)\n3)  identify variables that need to be mutated\n4)  mutate variables and sanity check all mutations\n\n## Task 1) Read in, Tidy, and Describe the Data\n\nI chose to read in the organic egg file, organiceggpoultry.xls. I use the same process as in [my Challenge 3 submission](https://dacss.github.io/601_Spring_2023/posts/TimShores_challenge3.html){.external target=\"_blank\"}. I left out the details in this post, and show only the first 18 of 1,080 lines of the final data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlistEggDFs <- map(set_names(excel_sheets(\"../posts/_data/organiceggpoultry.xls\")),\nread_xls, path = \"../posts/_data/organiceggpoultry.xls\") # read in all sheets as dataframes in a list\n\ndf_eggPoultryData <- map(names(listEggDFs), ~assign(.x, listEggDFs[[.x]], envir = .GlobalEnv))[[1]] # assign the first df in the list to a separate df\n\nproductname <- c(df_eggPoultryData[2,1],df_eggPoultryData[2,7]) # Store header values in list variables for use after pivot.\nunitname <- c(df_eggPoultryData[3,1],df_eggPoultryData[3,7])\n\ncolnames(df_eggPoultryData) <- df_eggPoultryData[4, ] # Assign values from the 4th populated row to column names\ncolnames(df_eggPoultryData)[1] <- \"month\" # source data has no name in date column\n\ndf_eggPoultryData <- df_eggPoultryData %>% \n  slice(-(1:4)) %>% # Slice off the first four rows, which do not have table data.\n  select(!`NA`) %>% # Select all columns but the empty one in the middle\n  separate_wider_delim(month, delim = \" \", names = c(\"month\", \"year\"), too_few = \"align_start\", too_many = \"merge\") %>% \n  mutate(month = replace(month, month == 'Jan', 'January')) %>%\n  mutate(year = replace(year, year == '/1', NA)) %>%\n  fill(year) %>% # tidy the month column and separate year into its own column. \n  pivot_longer(cols = -c(month,year), names_to = \"item\", values_to = \"price\") %>% # to pivot the egg and chicken product column headings into row values under a new `item` column, with their values listed in a `price` column\n  mutate(item = str_remove_all(item, '\\\\n')) %>% # tidy up item values and make labels consistent\n  mutate(item = str_remove_all(item, '1/2 Dozen')) %>%\n  mutate(item = str_replace_all(item, 'Doz\\\\.','Dozen')) %>%\n  mutate(product = case_when( # assign the egg and chicken product and unit variables that I recorded earlier according to each egg and chicken item\n    str_detect(item, regex(\"^[EL]\")) ~ productname[[1]],\n    str_detect(item, regex(\"^[BTW]\")) ~ productname[[2]]\n    )) %>% \n  mutate(unit = case_when( \n    str_detect(item, regex(\"^[EL]\")) ~ unitname[[1]],\n    str_detect(item, regex(\"^[BTW]\")) ~ unitname[[2]]\n    )) %>%\n  print(n=18) # print a sample of the table\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,080 × 6\n   month    year  item                  price   product                    unit \n   <chr>    <chr> <chr>                 <chr>   <chr>                      <chr>\n 1 January  2004  Extra Large Dozen     230     USDA Certified Organic Eg… Pric…\n 2 January  2004  Extra Large 1/2 Dozen 132     USDA Certified Organic Eg… Pric…\n 3 January  2004  Large Dozen           230     USDA Certified Organic Eg… Pric…\n 4 January  2004  Large 1/2 Dozen       126     USDA Certified Organic Eg… Pric…\n 5 January  2004  Whole                 197.5   USDA Certified Organic Yo… Pric…\n 6 January  2004  B/S Breast            645.5   USDA Certified Organic Yo… Pric…\n 7 January  2004  Bone-in Breast        too few USDA Certified Organic Yo… Pric…\n 8 January  2004  Whole Legs            193.5   USDA Certified Organic Yo… Pric…\n 9 January  2004  Thighs                too few USDA Certified Organic Yo… Pric…\n10 February 2004  Extra Large Dozen     230     USDA Certified Organic Eg… Pric…\n11 February 2004  Extra Large 1/2 Dozen 134.5   USDA Certified Organic Eg… Pric…\n12 February 2004  Large Dozen           226.25  USDA Certified Organic Eg… Pric…\n13 February 2004  Large 1/2 Dozen       128.5   USDA Certified Organic Eg… Pric…\n14 February 2004  Whole                 197.5   USDA Certified Organic Yo… Pric…\n15 February 2004  B/S Breast            642.5   USDA Certified Organic Yo… Pric…\n16 February 2004  Bone-in Breast        too few USDA Certified Organic Yo… Pric…\n17 February 2004  Whole Legs            193.5   USDA Certified Organic Yo… Pric…\n18 February 2004  Thighs                203     USDA Certified Organic Yo… Pric…\n# … with 1,062 more rows\n```\n:::\n:::\n\n\n### Briefly describe the data\n\nThe data describes the price of several types of USDA certified organic egg and chicken products from the years 2004 to 2013. The price was paid by 'first receivers', described in a footnote as \"those entities that purchases the processed product from the poultry or egg company, such as a retailer, distributor, or manufacturer.\" The cited data sources are the U.S. Department of Agriculture, Agricultural Marketing Service (AMS) Market News, Organic Poultry and Eggs (Weekly reports).\n\nThe data includes 6 variables (date, 4 egg carton items and 5 chicken items, and an empty column) with prices for 4 items for each month of 10 years in 1076 rows.\n\n\n## Identify variables that need to be mutated\n\nIn the Tidying code block above, I pivot the source data columns to a single `item` column. I then use several mutate functions to make the data more consistent and apply labels from other metadata taken from the original header.\n\nI also use mutate to create a month and year column, but these variables are still character data types. The `lubridate` package wants to use dates or datetimes. It can do calculations with periods such as months, but the output is still dates or datetimes rather than months. Meanwhile, the `zoo` package has the `yearmon` class that will return a year and month combo to represent dates on the scale of months.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_eggPoultryData$month <- as.yearmon(paste(df_eggPoultryData$year, df_eggPoultryData$month), \"%Y %B\")\ndf_eggPoultryData <- subset(df_eggPoultryData, select = -c(year))\nprint(df_eggPoultryData, n=18)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,080 × 5\n   month     item                  price   product                         unit \n   <yearmon> <chr>                 <chr>   <chr>                           <chr>\n 1 Jan 2004  Extra Large Dozen     230     USDA Certified Organic Eggs     Pric…\n 2 Jan 2004  Extra Large 1/2 Dozen 132     USDA Certified Organic Eggs     Pric…\n 3 Jan 2004  Large Dozen           230     USDA Certified Organic Eggs     Pric…\n 4 Jan 2004  Large 1/2 Dozen       126     USDA Certified Organic Eggs     Pric…\n 5 Jan 2004  Whole                 197.5   USDA Certified Organic Young C… Pric…\n 6 Jan 2004  B/S Breast            645.5   USDA Certified Organic Young C… Pric…\n 7 Jan 2004  Bone-in Breast        too few USDA Certified Organic Young C… Pric…\n 8 Jan 2004  Whole Legs            193.5   USDA Certified Organic Young C… Pric…\n 9 Jan 2004  Thighs                too few USDA Certified Organic Young C… Pric…\n10 Feb 2004  Extra Large Dozen     230     USDA Certified Organic Eggs     Pric…\n11 Feb 2004  Extra Large 1/2 Dozen 134.5   USDA Certified Organic Eggs     Pric…\n12 Feb 2004  Large Dozen           226.25  USDA Certified Organic Eggs     Pric…\n13 Feb 2004  Large 1/2 Dozen       128.5   USDA Certified Organic Eggs     Pric…\n14 Feb 2004  Whole                 197.5   USDA Certified Organic Young C… Pric…\n15 Feb 2004  B/S Breast            642.5   USDA Certified Organic Young C… Pric…\n16 Feb 2004  Bone-in Breast        too few USDA Certified Organic Young C… Pric…\n17 Feb 2004  Whole Legs            193.5   USDA Certified Organic Young C… Pric…\n18 Feb 2004  Thighs                203     USDA Certified Organic Young C… Pric…\n# … with 1,062 more rows\n```\n:::\n:::\n\n\nAny additional comments?\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}